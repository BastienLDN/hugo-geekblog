<article class="gblog-post">
    <header class="gblog-post__header">
        <h1><a href="{{ .RelPermalink }}">{{ partial "title" . }}</a></h1>
    </header>

    <section class="gblog-markdown">
        {{ .Summary }}
    </section>
    <div class="gblog-post__readmore">
        {{ if .Truncated }}
        <a class="flex-inline align-center" title="Read full post" href="{{ .RelPermalink }}">Read full post</a>
        {{ end }}
    </div>

    <footer class="gblog-post__footer">
        <span class="no-wrap">
        <svg class="icon menu"><use xlink:href="#date"></use></svg>
        <span class="gblog-post__tag">
            <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" | safeHTML }}">
                {{ .Date.Day }} {{ .Date.Month }} {{ .Date.Year }}
            </time>
        </span>
        </span>

        {{ $.Scratch.Set "author-counter" 0 }}
        {{ with .Params.authors }}
        {{ range sort . }}
            {{ $ac := $.Scratch.Get "author-counter" }}
            {{ $author := index $.Site.Data.authors . }}
            {{ with $.Site.GetPage (printf "/authors/%s" $author.name | urlize) }}
                {{ if eq $ac 0 }}
                <span class="no-wrap">
                <svg class="icon person"><use xlink:href="#person"></use></svg>
                {{ template "post-author" dict "name" $author.name "page" . }}
                </span>
                {{ else }}
                {{ template "post-author" dict "name" $author.name "page" . }}
                {{ end }}
            {{ end }}
            {{ $.Scratch.Set "author-counter" (add $ac 1) }}
        {{ end }}
        {{ end }}

        {{ $.Scratch.Set "tag-counter" 0 }}
        {{ with .Params.tags }}
        {{ range sort . }}
            {{ $tc := $.Scratch.Get "tag-counter" }}
            {{ $name := . }}
            {{ with $.Site.GetPage (printf "/tags/%s" $name | urlize) }}
                {{ if eq $tc 0 }}
                <span class="no-wrap">
                <svg class="icon tags"><use xlink:href="#tags"></use></svg>
                {{ template "post-tag" dict "name" $name "page" . }}
                </span>
                {{ else }}
                {{ template "post-tag" dict "name" $name "page" . }}
                {{ end }}
            {{ end }}
            {{ $.Scratch.Set "tag-counter" (add $tc 1) }}
        {{ end }}
        {{ end }}
    </footer>
</article>

{{ define "post-tag" }}
<span class="gblog-post__tag gblog-button">
    <a class="gblog-button__link" href="{{ .page.RelPermalink }}" title="All posts tagged with '{{ .name }}'">{{ .name }}</a>
</span>
{{ end }}

{{ define "post-author" }}
<span class="gblog-post__tag gblog-button">
    <a class="gblog-button__link" href="{{ .page.RelPermalink }}" title="All posts of this author">{{ .name }}</a>
</span>
{{ end }}
